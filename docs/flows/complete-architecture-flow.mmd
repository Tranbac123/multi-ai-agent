graph TB
    %% User Layer
    subgraph "ğŸ‘¥ User Layer"
        WebUser["ğŸ‘¤ Web User"]
        MobileUser["ğŸ“± Mobile User"]
        AdminUser["âš™ï¸ Admin User"]
        SocialUser["ğŸ“± Social Platform User"]
    end

    %% Frontend Layer
    subgraph "ğŸ¨ Frontend Layer"
        ChatbotUI["ğŸ¤– AI Chatbot UI<br/>:3001<br/>React + Real-time Search<br/>Live Web Integration"]
        WebDashboard["ğŸŒ Web Dashboard<br/>:3000<br/>React/Vite<br/>User Management"]
        AdminPanel["âš™ï¸ Admin Panel<br/>:8099<br/>FastAPI Backend<br/>System Administration"]
    end

    %% API Gateway Layer
    subgraph "ğŸšª API Gateway Layer"
        MainGateway["ğŸšª Main API Gateway<br/>:8000<br/>ğŸ” Authentication<br/>âš¡ Rate Limiting<br/>ğŸ¯ Request Routing<br/>ğŸŒ CORS Handling<br/>ğŸ“Š Request Validation"]
    end

    %% Core Processing Layer
    subgraph "ğŸ§  Core Processing Layer"
        IntelligentRouter["ğŸ¯ Intelligent Router<br/>:8083<br/>ğŸ§  Feature Extraction<br/>ğŸ“Š Tier Classification<br/>ğŸ² Bandit Policy<br/>ğŸ”„ Load Balancing"]
        
        WorkflowOrchestrator["ğŸ¼ Workflow Orchestrator<br/>:8081<br/>ğŸ“‹ LangGraph Workflows<br/>ğŸ”„ Saga Patterns<br/>ğŸ›¡ï¸ Loop Safety<br/>ğŸ”§ Tool Coordination"]
        
        AIModelGateway["ğŸ¤– AI Model Gateway<br/>:8080<br/>ğŸ¯ Provider Selection<br/>ğŸ’° Cost Optimization<br/>ğŸ“Š Token Management<br/>ğŸ”„ Failover Handling"]
    end

    %% Data & Intelligence Layer
    subgraph "ğŸ“š Data & Intelligence Layer"
        DocumentRetrieval["ğŸ“š Document Retrieval<br/>:8081<br/>ğŸ” RAG Processing<br/>ğŸ§® Vector Search<br/>ğŸ“Š Semantic Analysis<br/>ğŸ¯ Relevance Scoring"]
        
        ExternalTools["ğŸ› ï¸ External Tools<br/>:8082<br/>ğŸ•·ï¸ FIRECRAWL Web Search<br/>ğŸ”Œ API Integrations<br/>âš¡ Tool Execution<br/>ğŸ“Š Performance Metrics"]
        
        MultiChannelChat["ğŸ’¬ Multi-Channel Chat<br/>:8006<br/>ğŸ“± Facebook Integration<br/>ğŸ’¬ Zalo Integration<br/>ğŸµ TikTok Integration<br/>ğŸ”„ Message Normalization"]
    end

    %% Real-time & Performance Layer
    subgraph "âš¡ Real-time & Performance Layer"
        RealtimeGateway["âš¡ Realtime Gateway<br/>:8084<br/>ğŸ”Œ WebSocket Management<br/>ğŸ“¡ Message Streaming<br/>ğŸ›¡ï¸ Backpressure Control<br/>ğŸ”„ Connection Pooling"]
        
        IntelligentCache["ğŸ§  Semantic Cache<br/>:8085<br/>ğŸ¯ Similarity Matching<br/>âš¡ Response Optimization<br/>ğŸ“Š Cache Analytics<br/>ğŸ”„ TTL Management"]
        
        EventRelay["ğŸ“¡ Event Relay<br/>:8087<br/>ğŸ”„ Webhook Delivery<br/>ğŸ“Š Message Queuing<br/>ğŸ›¡ï¸ Circuit Breaker<br/>ğŸ“ˆ Retry Logic"]
    end

    %% Control Plane Layer
    subgraph "ğŸ›ï¸ Control Plane Layer"
        ConfigManagement["âš™ï¸ Config Management<br/>:8090<br/>ğŸ”§ Environment Settings<br/>ğŸ›ï¸ Runtime Configuration<br/>ğŸ“Š Feature Toggles<br/>ğŸ”„ Dynamic Updates"]
        
        PolicyEngine["ğŸ“‹ Policy Engine<br/>:8091<br/>ğŸ›¡ï¸ Access Control<br/>ğŸ“Š Compliance Rules<br/>ğŸ¯ Decision Engine<br/>ğŸ“ Policy Auditing"]
        
        FeatureManagement["ğŸš© Feature Management<br/>:8092<br/>ğŸ›ï¸ Runtime Toggles<br/>ğŸ§ª A/B Testing<br/>ğŸ¯ Canary Deployments<br/>ğŸ“Š Experiment Analytics"]
        
        ServiceRegistry["ğŸ“‹ Service Registry<br/>:8094<br/>ğŸ” Service Discovery<br/>â¤ï¸ Health Monitoring<br/>ğŸ“Š Load Balancing<br/>ğŸ”„ Failover Management"]
        
        UsageTracking["ğŸ“Š Usage Tracking<br/>:8095<br/>ğŸ’° Cost Monitoring<br/>ğŸ“ˆ Usage Analytics<br/>ğŸš¨ Budget Alerts<br/>ğŸ“Š Performance Metrics"]
        
        AuditSystem["ğŸ“ Audit System<br/>:8096<br/>ğŸ“Š Activity Logging<br/>ğŸ›¡ï¸ Security Events<br/>ğŸ“‹ Compliance Tracking<br/>ğŸ” Forensic Analysis"]
        
        NotificationHub["ğŸ“¢ Notification Hub<br/>:8097<br/>ğŸ“§ Multi-channel Alerts<br/>ğŸ¯ Smart Routing<br/>ğŸ“Š Delivery Tracking<br/>ğŸ”„ Retry Logic"]
    end

    %% Infrastructure Layer
    subgraph "ğŸ—ï¸ Infrastructure Layer"
        PrimaryDatabase["ğŸ˜ Primary Database<br/>:5432<br/>ğŸ’¾ ACID Compliance<br/>ğŸ¢ Multi-tenant RLS<br/>ğŸ“Š JSON Support<br/>ğŸ”„ Connection Pooling"]
        
        CacheLayer["ğŸ”´ Cache Layer<br/>:6379<br/>âš¡ Session Storage<br/>ğŸ“Š Pub/Sub Messaging<br/>ğŸ”„ Clustering<br/>ğŸ“ˆ Performance Monitoring"]
        
        EventStreaming["ğŸ“¡ Event Streaming<br/>:4222<br/>ğŸ”„ Guaranteed Delivery<br/>ğŸ“Š Message Queuing<br/>ğŸ›¡ï¸ Dead Letter Queues<br/>ğŸ“ˆ Scalability"]
        
        VectorStorage["ğŸ§® Vector Storage<br/>Embeddings Database<br/>ğŸ¯ Similarity Search<br/>ğŸ“Š Index Management<br/>ğŸ”„ Backup & Recovery"]
    end

    %% External Services Layer
    subgraph "ğŸŒ External Services Layer"
        OpenAIServices["ğŸ§  OpenAI Services<br/>GPT-4 â€¢ GPT-3.5<br/>ğŸ“Š Text Generation<br/>ğŸ’° Token-based Pricing<br/>ğŸ”„ Rate Limiting"]
        
        AnthropicServices["ğŸ¤– Anthropic Services<br/>Claude Models<br/>ğŸ§  Advanced Reasoning<br/>ğŸ’° Cost Optimization<br/>ğŸ”„ Multi-modal Support"]
        
        WebScrapingServices["ğŸ•·ï¸ Web Scraping Services<br/>FIRECRAWL API<br/>ğŸŒ Live Web Search<br/>ğŸ“Š Content Extraction<br/>ğŸ”„ Real-time Data"]
        
        PaymentServices["ğŸ’³ Payment Services<br/>Stripe API<br/>ğŸ’° Billing Management<br/>ğŸ“Š Invoice Generation<br/>ğŸ”„ Payment Processing"]
        
        SocialPlatforms["ğŸ“± Social Platforms<br/>Facebook Messenger<br/>ğŸ’¬ Zalo Chat<br/>ğŸµ TikTok<br/>ğŸ”„ Webhook Endpoints"]
    end

    %% User Connections
    WebUser --> ChatbotUI
    WebUser --> WebDashboard
    MobileUser --> ChatbotUI
    AdminUser --> AdminPanel
    SocialUser --> SocialPlatforms

    %% Frontend to Gateway
    ChatbotUI -->|"ğŸ“¤ POST /ask<br/>ğŸ” JWT Auth<br/>ğŸ“Š Session Management"| MainGateway
    WebDashboard -->|"ğŸŒ REST API<br/>ğŸ“Š Data Fetching<br/>ğŸ›ï¸ User Management"| MainGateway
    AdminPanel -->|"âš™ï¸ Admin APIs<br/>ğŸ›¡ï¸ Privileged Access<br/>ğŸ“Š System Control"| MainGateway

    %% Gateway to Core Processing
    MainGateway -->|"ğŸ¯ Intelligent Routing<br/>ğŸ“Š Feature Analysis<br/>ğŸ”„ Load Balancing"| IntelligentRouter
    IntelligentRouter -->|"ğŸ¼ Workflow Execution<br/>ğŸ”„ Multi-step Processing<br/>ğŸ›¡ï¸ Safety Controls"| WorkflowOrchestrator
    WorkflowOrchestrator -->|"ğŸ¤– AI Model Requests<br/>ğŸ’° Cost Optimization<br/>ğŸ”„ Provider Selection"| AIModelGateway

    %% Core to Data & Intelligence
    WorkflowOrchestrator -->|"ğŸ“š Document Retrieval<br/>ğŸ§® Vector Search<br/>ğŸ¯ RAG Processing"| DocumentRetrieval
    WorkflowOrchestrator -->|"ğŸ› ï¸ External Tools<br/>ğŸ•·ï¸ Web Search<br/>ğŸ”Œ API Calls"| ExternalTools
    SocialPlatforms -->|"ğŸ’¬ Message Processing<br/>ğŸ”„ Platform Integration<br/>ğŸ“Š Normalization"| MultiChannelChat

    %% Real-time & Performance
    MainGateway -->|"âš¡ WebSocket Upgrade<br/>ğŸ“¡ Real-time Streaming<br/>ğŸ›¡ï¸ Connection Management"| RealtimeGateway
    MainGateway -->|"ğŸ§  Response Caching<br/>ğŸ¯ Similarity Matching<br/>âš¡ Performance Optimization"| IntelligentCache
    WorkflowOrchestrator -->|"ğŸ“¡ Event Publishing<br/>ğŸ”„ Webhook Delivery<br/>ğŸ›¡ï¸ Circuit Breaker"| EventRelay

    %% Control Plane Interactions
    MainGateway -->|"âš™ï¸ Configuration<br/>ğŸ›ï¸ Runtime Settings<br/>ğŸ”„ Dynamic Updates"| ConfigManagement
    MainGateway -->|"ğŸ“‹ Policy Checks<br/>ğŸ›¡ï¸ Access Control<br/>ğŸ“Š Compliance"| PolicyEngine
    MainGateway -->|"ğŸš© Feature Flags<br/>ğŸ§ª A/B Testing<br/>ğŸ¯ Canary Deployments"| FeatureManagement
    MainGateway -->|"ğŸ“‹ Service Discovery<br/>â¤ï¸ Health Checks<br/>ğŸ”„ Load Balancing"| ServiceRegistry
    MainGateway -->|"ğŸ“Š Usage Tracking<br/>ğŸ’° Cost Monitoring<br/>ğŸš¨ Budget Alerts"| UsageTracking
    MainGateway -->|"ğŸ“ Audit Logging<br/>ğŸ›¡ï¸ Security Events<br/>ğŸ“‹ Compliance"| AuditSystem

    %% Infrastructure Dependencies
    MainGateway -->|"ğŸ’¾ Data Persistence<br/>ğŸ¢ Multi-tenant Storage<br/>ğŸ”„ ACID Transactions"| PrimaryDatabase
    MainGateway -->|"âš¡ Session Storage<br/>ğŸ“Š Caching Layer<br/>ğŸ”„ Pub/Sub Events"| CacheLayer
    MainGateway -->|"ğŸ“¡ Event Streaming<br/>ğŸ”„ Message Queuing<br/>ğŸ›¡ï¸ Guaranteed Delivery"| EventStreaming
    
    DocumentRetrieval -->|"ğŸ§® Vector Storage<br/>ğŸ¯ Embedding Indexing<br/>ğŸ“Š Similarity Search"| VectorStorage
    DocumentRetrieval -->|"ğŸ’¾ Document Storage<br/>ğŸ“Š Metadata Management<br/>ğŸ¢ RLS Isolation"| PrimaryDatabase
    
    RealtimeGateway -->|"âš¡ Session Storage<br/>ğŸ“Š Message Buffering<br/>ğŸ”„ Connection Management"| CacheLayer
    RealtimeGateway -->|"ğŸ“¡ Event Broadcasting<br/>ğŸ”„ Real-time Updates<br/>ğŸ“Š Message Streaming"| EventStreaming

    %% External API Calls
    AIModelGateway -->|"ğŸ§  GPT Completions<br/>ğŸ“Š Text Generation<br/>ğŸ’° Token Usage"| OpenAIServices
    AIModelGateway -->|"ğŸ¤– Claude Completions<br/>ğŸ§  Advanced Reasoning<br/>ğŸ”„ Multi-modal"| AnthropicServices
    ExternalTools -->|"ğŸ•·ï¸ Web Scraping<br/>ğŸŒ Live Data Search<br/>ğŸ“Š Content Extraction"| WebScrapingServices
    UsageTracking -->|"ğŸ’³ Payment Processing<br/>ğŸ“Š Invoice Generation<br/>ğŸ”„ Subscription Management"| PaymentServices

    %% Event Publishing
    MainGateway -.->|"ğŸ“Š Usage Events<br/>tenant.usage.*"| EventStreaming
    MainGateway -.->|"ğŸ“ Audit Events<br/>tenant.audit.*"| EventStreaming
    AIModelGateway -.->|"ğŸ¤– Model Events<br/>model.usage.*"| EventStreaming
    ExternalTools -.->|"ğŸ› ï¸ Tool Events<br/>tool.execution.*"| EventStreaming
    UsageTracking -.->|"ğŸ’° Billing Events<br/>tenant.billing.*"| EventStreaming

    %% Response Flow
    AIModelGateway -->|"ğŸ¤– AI Response<br/>ğŸ“Š Generated Content<br/>ğŸ’° Usage Metrics"| MainGateway
    DocumentRetrieval -->|"ğŸ“š Document Results<br/>ğŸ¯ Relevance Scores<br/>ğŸ“Š Source Citations"| MainGateway
    ExternalTools -->|"ğŸ› ï¸ Tool Output<br/>ğŸŒ External Data<br/>ğŸ“Š Execution Metrics"| MainGateway
    
    MainGateway -->|"ğŸ’¬ Final Response<br/>ğŸ“Š Citations â€¢ Trace<br/>ğŸ’° Usage Data"| ChatbotUI
    MainGateway -->|"ğŸŒ API Response<br/>ğŸ“Š JSON Data<br/>ğŸ“ˆ Status Codes"| WebDashboard
    MainGateway -->|"âš™ï¸ Admin Response<br/>ğŸ“Š Management Data<br/>ğŸ“ˆ System Status"| AdminPanel

    %% Real-time Updates
    RealtimeGateway -->|"ğŸ“¡ WebSocket Messages<br/>ğŸ”„ Real-time Updates<br/>ğŸ“Š Streaming Response"| ChatbotUI

    %% Styling
    classDef userLayer fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    classDef frontendLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef gatewayLayer fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    classDef coreLayer fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef dataLayer fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef realtimeLayer fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    classDef controlLayer fill:#fff8e1,stroke:#fbc02d,stroke-width:2px
    classDef infraLayer fill:#efebe9,stroke:#5d4037,stroke-width:2px
    classDef externalLayer fill:#ffebee,stroke:#d32f2f,stroke-width:2px

    class WebUser,MobileUser,AdminUser,SocialUser userLayer
    class ChatbotUI,WebDashboard,AdminPanel frontendLayer
    class MainGateway gatewayLayer
    class IntelligentRouter,WorkflowOrchestrator,AIModelGateway coreLayer
    class DocumentRetrieval,ExternalTools,MultiChannelChat dataLayer
    class RealtimeGateway,IntelligentCache,EventRelay realtimeLayer
    class ConfigManagement,PolicyEngine,FeatureManagement,ServiceRegistry,UsageTracking,AuditSystem,NotificationHub controlLayer
    class PrimaryDatabase,CacheLayer,EventStreaming,VectorStorage infraLayer
    class OpenAIServices,AnthropicServices,WebScrapingServices,PaymentServices,SocialPlatforms externalLayer
