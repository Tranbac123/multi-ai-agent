graph TB
    %% User Input Types
    subgraph "ğŸ‘¤ User Input Types"
        ChatQuery["ğŸ’¬ Chat Query<br/>\"What's the weather?\"<br/>\"Explain AI\"<br/>\"Latest news\""]
        DocumentUpload["ğŸ“„ Document Upload<br/>PDF â€¢ DOCX â€¢ TXT<br/>Company Handbook<br/>Technical Docs"]
        SocialMessage["ğŸ“± Social Message<br/>Facebook Messenger<br/>Zalo Chat â€¢ TikTok<br/>Multi-platform"]
        AdminAction["âš™ï¸ Admin Action<br/>User Management<br/>System Configuration<br/>Analytics Viewing"]
    end

    %% Processing Paths
    subgraph "ğŸ”„ Processing Paths"
        subgraph "ğŸ’¬ Chat Processing Path"
            ChatGateway["ğŸšª API Gateway<br/>:8000<br/>Authentication<br/>Rate Limiting"]
            ChatRouter["ğŸ¯ Router Service<br/>:8083<br/>Query Classification<br/>Tier Selection"]
            ChatOrchestrator["ğŸ¼ Orchestrator<br/>:8081<br/>Workflow Execution<br/>Tool Coordination"]
            
            subgraph "ğŸ” Web Search Branch"
                WebTools["ğŸ› ï¸ Tools Service<br/>:8082<br/>FIRECRAWL Integration"]
                WebSearch["ğŸ•·ï¸ FIRECRAWL API<br/>Live Web Search<br/>Real-time Data"]
            end
            
            subgraph "ğŸ§  AI Processing Branch"
                AIModel["ğŸ¤– Model Gateway<br/>:8080<br/>AI Model Routing"]
                OpenAI["ğŸ§  OpenAI API<br/>GPT-4 â€¢ GPT-3.5<br/>Text Generation"]
                Anthropic["ğŸ¤– Anthropic API<br/>Claude Models<br/>Advanced Reasoning"]
            end
            
            subgraph "ğŸ“š Knowledge Branch"
                Retrieval["ğŸ“š Retrieval Service<br/>:8081<br/>Document Search"]
                VectorDB["ğŸ§® Vector Database<br/>Embeddings<br/>Semantic Search"]
            end
        end
        
        subgraph "ğŸ“„ Document Processing Path"
            DocGateway["ğŸšª API Gateway<br/>:8000<br/>File Upload<br/>Validation"]
            Ingestion["ğŸ“¥ Ingestion Service<br/>:8004<br/>Text Extraction<br/>PII Detection"]
            DocProcessing["âš™ï¸ Document Processing<br/>Chunking â€¢ Embedding<br/>Indexing â€¢ Storage"]
        end
        
        subgraph "ğŸ“± Social Processing Path"
            SocialAdapter["ğŸ’¬ Chat Adapters<br/>:8006<br/>Platform Integration<br/>Message Normalization"]
            SocialGateway["ğŸšª API Gateway<br/>:8000<br/>Unified Processing"]
            SocialResponse["ğŸ“¤ Response Routing<br/>Platform-specific<br/>Formatting"]
        end
        
        subgraph "âš™ï¸ Admin Processing Path"
            AdminGateway["ğŸšª API Gateway<br/>:8000<br/>Admin Authentication<br/>Permission Checks"]
            AdminServices["ğŸ›ï¸ Control Plane<br/>Config â€¢ Policy<br/>Usage â€¢ Audit"]
            AdminData["ğŸ“Š Admin Dashboard<br/>Analytics â€¢ Reports<br/>System Management"]
        end
    end

    %% Real-time Layer
    subgraph "âš¡ Real-time Communication"
        RealtimeGateway["âš¡ Realtime Gateway<br/>:8084<br/>WebSocket Management<br/>Message Streaming"]
        SemanticCache["ğŸ§  Semantic Cache<br/>:8085<br/>Response Caching<br/>Performance Optimization"]
    end

    %% Data Storage Layer
    subgraph "ğŸ’¾ Data Storage Layer"
        Postgres["ğŸ˜ PostgreSQL<br/>:5432<br/>Primary Database<br/>Multi-tenant RLS<br/>ACID Compliance"]
        Redis["ğŸ”´ Redis<br/>:6379<br/>Session Storage<br/>Caching Layer<br/>Pub/Sub Messaging"]
        NATS["ğŸ“¡ NATS JetStream<br/>:4222<br/>Event Streaming<br/>Message Queuing<br/>Guaranteed Delivery"]
        VectorStorage["ğŸ§® Vector Storage<br/>Embeddings Database<br/>Similarity Search<br/>Index Management"]
    end

    %% Control & Monitoring
    subgraph "ğŸ›ï¸ Control & Monitoring"
        ConfigService["âš™ï¸ Config Service<br/>:8090<br/>Configuration<br/>Environment Settings"]
        PolicyAdapter["ğŸ“‹ Policy Adapter<br/>:8091<br/>Policy Enforcement<br/>Access Control"]
        FeatureFlags["ğŸš© Feature Flags<br/>:8092<br/>Runtime Toggles<br/>A/B Testing"]
        UsageMetering["ğŸ“Š Usage Metering<br/>:8095<br/>Cost Tracking<br/>Budget Monitoring"]
        AuditLog["ğŸ“ Audit Log<br/>:8096<br/>Activity Tracking<br/>Compliance Logging"]
    end

    %% Output Types
    subgraph "ğŸ“¤ Output Types"
        ChatResponse["ğŸ’¬ Chat Response<br/>AI-generated Answer<br/>Live Web Data<br/>Source Citations"]
        DocumentStatus["ğŸ“„ Document Status<br/>Processing Complete<br/>Indexed & Searchable<br/>Metadata Available"]
        SocialResponse["ğŸ“± Social Response<br/>Platform-formatted<br/>Message Delivery<br/>Status Tracking"]
        AdminDashboard["âš™ï¸ Admin Dashboard<br/>System Analytics<br/>User Management<br/>Configuration UI"]
    end

    %% Chat Query Flow
    ChatQuery --> ChatGateway
    ChatGateway --> ChatRouter
    ChatRouter --> ChatOrchestrator
    ChatOrchestrator --> WebTools
    ChatOrchestrator --> AIModel
    ChatOrchestrator --> Retrieval
    
    WebTools --> WebSearch
    AIModel --> OpenAI
    AIModel --> Anthropic
    Retrieval --> VectorDB
    
    ChatOrchestrator --> RealtimeGateway
    ChatOrchestrator --> SemanticCache
    
    %% Document Upload Flow
    DocumentUpload --> DocGateway
    DocGateway --> Ingestion
    Ingestion --> DocProcessing
    DocProcessing --> VectorStorage
    DocProcessing --> Postgres
    
    %% Social Message Flow
    SocialMessage --> SocialAdapter
    SocialAdapter --> SocialGateway
    SocialGateway --> ChatRouter
    ChatRouter --> SocialResponse
    
    %% Admin Action Flow
    AdminAction --> AdminGateway
    AdminGateway --> AdminServices
    AdminServices --> AdminData
    
    %% Control Plane Interactions
    ChatGateway --> ConfigService
    ChatGateway --> PolicyAdapter
    ChatGateway --> FeatureFlags
    ChatGateway --> UsageMetering
    ChatGateway --> AuditLog
    
    %% Data Storage Interactions
    ChatGateway --> Postgres
    ChatGateway --> Redis
    ChatGateway --> NATS
    Retrieval --> Postgres
    Retrieval --> VectorStorage
    RealtimeGateway --> Redis
    RealtimeGateway --> NATS
    Ingestion --> Postgres
    Ingestion --> VectorStorage
    
    %% Final Outputs
    ChatOrchestrator --> ChatResponse
    DocProcessing --> DocumentStatus
    SocialResponse --> SocialResponse
    AdminData --> AdminDashboard
    
    %% Event Publishing
    ChatGateway -.->|"Usage Events"| NATS
    ChatGateway -.->|"Audit Events"| NATS
    AIModel -.->|"Model Events"| NATS
    WebTools -.->|"Tool Events"| NATS
    UsageMetering -.->|"Billing Events"| NATS
    
    %% Styling
    classDef inputType fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef processingPath fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef realtimeLayer fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    classDef dataStorage fill:#efebe9,stroke:#5d4037,stroke-width:2px
    classDef controlMonitoring fill:#fff8e1,stroke:#fbc02d,stroke-width:2px
    classDef outputType fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef externalAPI fill:#ffebee,stroke:#d32f2f,stroke-width:2px

    class ChatQuery,DocumentUpload,SocialMessage,AdminAction inputType
    class ChatGateway,ChatRouter,ChatOrchestrator,WebTools,AIModel,Retrieval,DocGateway,Ingestion,DocProcessing,SocialAdapter,SocialGateway,SocialResponse,AdminGateway,AdminServices,AdminData processingPath
    class RealtimeGateway,SemanticCache realtimeLayer
    class Postgres,Redis,NATS,VectorStorage,VectorDB dataStorage
    class ConfigService,PolicyAdapter,FeatureFlags,UsageMetering,AuditLog controlMonitoring
    class ChatResponse,DocumentStatus,SocialResponse,AdminDashboard outputType
    class WebSearch,OpenAI,Anthropic externalAPI
